# KVStorage

База данных, которая хранит строки в формате *ключ-значение*, также можно указывать время жизни того или иного значения. 

Может работать в многопоточном режиме, в формате: "**либо много потоков одновременно читают, либо один пишет**".

Основана на *декартовом дереве*, выполняет почти все операции за *O(log(N))*.

### *Асимпототика:*
*Далее, если не указано обратного **N** - это примерный размер структуры (число вставок).*
- `KVStorage(clock)` - **O(1)**
- `KVStorage(data, clock)` - **O(N * log(N))**
- `~KVStorage()` - **O(N)**
- `set(key, value, ttl)` - **O(log(N))**
- `remove(key)` - **O(log(N))**
- `get(key)` - **O(log(N))**
- `getManySorted(key, count)` - **O(log(N) + count)**
- `removeOneExpiredEntry()` - **O(log(N))**

### *Оверхед на вставку одного элемента:*
На одну `Node` хранится (кроме исходных данных) 3 указателя: `parent`, `left`, `right` и `prio` - для работы дерева.
Также внутри самого `KVStorage` хранится еще `ttl` и `key` (можно было бы оптимизировать, но это сложнее).

3 * 8 байт (указатели) + 4 байта (`prio`) + 8 байт (`ttl` второй раз) + `key` (размер может быть разный)

**ИТОГО: 36 байт + `sizeof(key)`**

### *Тестирование:*
Есть автотесты! Вроде работают. Но если что вдруг:

- `make build-conf` - собрать с проектом в пресете для компилятора `conf` 
- `make test-conf` - то же самое, но еще и запустить *gtest*
- `make format` - отформатировать все файлы в стиле *clang-format*
- `make clean` - удалить папки с билдом
